# Dispersion Curves of Circumferential Surface Waves

The way in which a surface wave propagates (e.g. a Rayleigh wave) on a circumference differs from that of an infinite flat half-space when the wavelengths are comparable to the circumference ($2 \pi R/\lambda$ < 200).  The curvature can cause apparent phase velocities not related to the true speed of a material.  Even changes in the phase of the waveforms have been reported in the literature (See Clorennec and Royer (2003) and Brune et al. (1961)
for instance).

The dispersion equations for time-harmonic circumferential waves can be found in several research papers for different geometries (e.g. thin solid discs, annulii, cylinders, spheres, concentric cilinders or spheres).

The following list of references does not pretend to be exhaustive, nevertheless it provides an idea of the interest in these waves and their scale, ranging from geophysics to material engineering and produce characterization.

[![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/edur409/Circumferential-Surface-Waves/main)

## References
- Lamb, H. (1881). On the vibrations of an elastic sphere. Proceedings of the London Mathematical Society, 1(1), 189-212. [doi: https://doi.org/10.1112/plms/s1-13.1.189](https://doi.org/10.1112/plms/s1-13.1.189)
  
- Sezawa, K. (1927). On the propagation of Rayleigh waves on plane and spherical surfaces. Bull. Earthquake Res. Inst.(Tokyo), 2, 21-28.

- Brune, J. N., Nafe, J. E., & Alsop, L. E. (1961). The polar phase shift of surface waves on a sphere. Bulletin of the Seismological Society of America, 51(2), 247-257. [doi: https://doi.org/10.1785/BSSA0510020247](https://doi.org/10.1785/BSSA0510020247)

- Sato, Y. and Usami, T. (1962). Basic study on the oscillation of a homogeneous elastic sphere-Part I: Frequency of the Free Oscillations, Geophysical Magazine, 31(15-24).

- Viktorov, I. A. (1967). Rayleigh and Lamb waves. Rayleigh and Lamb Waves, 113.

- Gregory, R. D. (1971). The propagation of Rayleigh waves over curved surfaces at high frequency. In Mathematical Proceedings of the Cambridge Philosophical Society (Vol. 70, No. 1, pp. 103-121). Cambridge University Press. [doi: https://doi.org/10.1017/S0305004100049720](https://doi.org/10.1017/S0305004100049720)

- Cooke, J. R., & Rand, R. H. (1973). A mathematical study of resonance in intact fruits and vegetables using a 3-media elastic sphere model. Journal of agricultural engineering research, 18(2), 141-157.[doi: https://doi.org/10.1016/0021-8634(73)90023-1](https://doi.org/10.1016/0021-8634(73)90023-1)

- Eringen, A. C., & Suhubi, E. S. (1975). Elastodynamics. Vol 2: Linear theory. Academic press. 

- Okal, E. A. (1978). A physical classification of the Earth's spheroidal modes. Journal of Physics of the Earth, 26(1), 75-103. [doi: https://doi.org/10.4294/jpe1952.26.75](https://doi.org/10.4294/jpe1952.26.75)

- Odaka, T., & Usami, T. (1978). Some properties of spheroidal modes of a homogeneous elastic sphere with special reference to radial dependence of displacement. Journal of Computational Physics, 29(3), 431-445. [doi: https://doi.org/10.1016/0021-9991(78)90145-6](https://doi.org/10.1016/0021-9991(78)90145-6)

- Schwab, F., Frez, J., Panza, G. F., Liao, A. H., & Kausel, E. G. (1981). Surface-wave dispersion computations: Rayleigh waves on a spherical, gravitating earth. Bulletin of the Seismological Society of America, 71(3), 613-654. [doi: https://doi.org/10.1785/BSSA0710030613](https://doi.org/10.1785/BSSA0710030613)

- Cerv J., 1988, “Dispersion of Elastic Waves and Rayleigh-type Waves in a Thin Disc”, Acta Technica Csav, Vol. 89, pp. 89–99.

- Visscher, W. M., Migliori, A., Bell, T. M., & Reinert, R. A. (1991). On the normal modes of free vibration of inhomogeneous and anisotropic elastic objects. The Journal of the Acoustical Society of America, 90(4), 2154-2162. [doi: https://doi.org/10.1121/1.401643](https://doi.org/10.1121/1.401643)

- Liu, Guoli, and Jianmin Qu. "Guided circumferential waves in a circular annulus." (1998): 424-430. [doi: https://doi.org/10.1115/1.2789071](https://doi.org/10.1115/1.2789071)

- Valle, C., Qu, J., & Jacobs, L. J. (1999). Guided circumferential waves in layered cylinders. International Journal of Engineering Science, 37(11), 1369-1387. [doi: https://doi.org/10.1016/S0020-7225(98)00133-5](https://doi.org/10.1016/S0020-7225(98)00133-5) [CAUTION: Equations in this paper and her thesis differ]

- Clorennec, D., & Royer, D. (2003). Analysis of surface acoustic wave propagation on a cylinder using laser ultrasonics. Applied physics letters, 82(25), 4608-4610. [doi: https://doi.org/10.1063/1.1586463](https://doi.org/10.1063/1.1586463)

- Clorennec, D., & Royer, D. (2004). Investigation of surface acoustic wave propagation on a sphere using laser ultrasonics. Applied physics letters, 85(12), 2435-2437. [doi: https://doi.org/10.1063/1.1791331](https://doi.org/10.1063/1.1791331)

- Saviot, L., Murray, D. B., Mermet, A., & Duval, E. (2004). Comment on “Estimate of the vibrational frequencies of spherical virus particles”. Physical Review E, 69(2), 023901. [doi: https://doi.org/10.1103/PhysRevE.69.023901](https://doi.org/10.1103/PhysRevE.69.023901)

- Saviot, L. (2018). Vibrations of single-crystal gold nanorods and nanowires. Physical Review B, 97(15), 155420. [doi: https://doi.org/10.1103/PhysRevB.97.155420](https://doi.org/10.1103/PhysRevB.97.155420)
  
- Jaganathan, A. P. (2019). Multichannel surface wave analysis of reinforced concrete pipe segments using longitudinal and circumferential waves induced by a point impact. Journal of Applied Geophysics, 163, 40-54. [doi: https://doi.org/10.1016/j.jappgeo.2019.02.010](https://doi.org/10.1016/j.jappgeo.2019.02.010)

- Gallezot, M., Treyssede, F., & Abraham, O. (2020). Forced vibrations and wave propagation in multilayered solid spheres using a one-dimensional semi-analytical finite element method. Wave Motion, 96, 102555. [doi: https://doi.org/10.1016/j.wavemoti.2020.102555](https://doi.org/10.1016/j.wavemoti.2020.102555)

> [!NOTE]  
> The equations presented in Cerv (1988), those in Viktorov's book, and those in Gregory (1971) produce exactly the same dispersion curve results.  The circumferential surface wave around the outline of a thin solid disk is equivalent to that of a cylinder. Liu et. al, (1998) is a good reference to the problem of surface waves in thin pipes.

> [!WARNING]  
> The velocity dispersion of the Rayleigh mode for a steel sphere is different in Clorennec and Royer (2004) [Fig 1.] compared to Gallezot et al. (2020) [Fig 7.].  This is due to the equations used by Clorennec and Royer (2004) from Sato and Usami (1962); if the angular wavenumber $k_p$ around the sphere is taken as an integer instead of an integer and a half, the results are in disagreement.  In other words, if the dimensionless angular wavenumber $k_p$ is mistaken for the spherical harmonic order (co-latitudinal order) $l$ and given only integer values, then **Jeans' rule** or **Jeans' equation** ($k_p = l + 1/2$ or $2 \pi R/ \lambda = l + 1/2$) is not satisfied.  The following references can help clarify this seemingly puzzling equation:

- Ben-Menahem, A. (1964). Mode-ray duality. Bulletin of the Seismological Society of America, 54(5A), 1315-1321. [doi: https://doi.org/10.1785/BSSA05405A1315](https://doi.org/10.1785/BSSA05405A1315)

- Ben-Menahem, A., & Singh, S. J. (1981). Seismic waves and sources. Springer Science & Business Media. [doi: https://doi.org/10.1007/978-1-4612-5856-8](https://doi.org/10.1007/978-1-4612-5856-8)

- Knopoff, L., Rydelek, P. A., & Zurn, W. Twenty Two—The Transient Regime of the Free Oscillation Spectrum: The View from the South Pole. In: Litehiser, Joe J., editor Observatory Seismology: A Centennial Symposium for the Berkeley Seismographic Stations. Berkeley:  University of California Press,  c1989 1989. http://ark.cdlib.org/ark:/13030/ft7m3nb4pj/

- Snieder, R., & Van Wijk, K. (2015). A guided tour of mathematical methods for the physical sciences. Cambridge University Press. [doi: https://doi.org/10.1017/CBO9781139013543](https://doi.org/10.1017/CBO9781139013543)

From Knopoff et al. (1989):

> "There is a reciprocity between the free-mode and the traveling-wave descriptions that is given by Jeans's formula, $ka = l + \frac{1}{2}$, where $l$ is the mode number, $k = w/c$ , $w = 2 \pi/ T$ , $T$ is the period of free oscillations, $a$ is the radius of the Earth, and $c$ is the phase velocity of the corresponding traveling waves. Since the free oscillations are the standing wave system formed out of the appropriate traveling surface waves of the same period, we can use either point of view, as convenience dictates."

From page 324 of Snieder and van Wijk (2015):
> "This means that the total number of waves that fit around the globe is given by $(l + \textonehalf{})$.  It may surprise you that the number of oscillations in one loop around the globe is not an integer.  One would expect that the requirement of constructive interference would dictate that an integer number of wavelengths should "fit" this interval.  ...The fact that $(l + \textonehalf{})$ rather than $l$ oscillations fit on the sphere has a profound effect in quantum mechanics."

I infer Clorennec and Royer (2004) did not use Jeans' rule since they assert in the third paragraph of page 2435: "An integer value $n$ of $ka$ corresponds to a resonance frequency $\omega_n$". That statement is correct for the cylinder though.  In their notation, $n$ is the spherical harmonic order $l$, as in Equation 2.2 of Sato and Usami (1962) for the spheroidal oscillation.

> [!TIP]
> A good resource online for checking and visualizing the vibrational eigenmodes of simple shapes (i.e cylinder, spheres, and more) is provided by researcher Lucien Saviot here: [https://saviot.cnrs.fr/index.en.html](https://saviot.cnrs.fr/index.en.html). Check Saviot et al. (2004) in the references above. In the [Fundamental Modes](https://github.com/edur409/Circumferential-Surface-Waves/tree/main/Fundamental_Modes) folder there is a notebook to calculate the fundamental modes of a homogenous sphere. The fundamental modes are also calculated by the variational method of Visscher et al. (1991) in the folder [RUS](https://github.com/edur409/Circumferential-Surface-Waves/tree/main/RUS). Details on the README.md files of the respective folders.

# CMASW inversion code structure

CMASW stands for Circumferential Multichannel Analysis of Surface Waves and it is written as a modification of MASW code written by:

> Hongwei Liu, Pooneh Maghoul, & Ahmed Shalaby. (2020). Intelligent MASW (1.0.0). Zenodo. https://doi.org/10.5281/zenodo.3776875

The link to the original codes can be found here: [Intelligent-MASW](https://github.com/Siglab-code/Intelligent-MASW) or here: [zenodo.3776875](https://zenodo.org/records/3776875).

A peer-reviewed publication using the original codes can be found here: [Integrated approach for the MASW dispersion analysis using the spectral element technique and trust region reflective method](https://doi.org/10.1016/j.compgeo.2020.103689).

> Liu, H., Maghoul, P., Shalaby, A., Bahari, A., & Moradi, F. (2020). Integrated approach for the MASW dispersion analysis using the spectral element technique and trust region reflective method. Computers and Geotechnics, 125, 103689.

The inversion program is written in Python as a class and is intended to fit the dispersion curves of circumferential surface waves.

The dispersion curves are calculated using multi-array sensors equi-spaced around the circumference of the object. The main algorithm for doing so is based on this publication by [Park et al. (1998)](https://doi.org/10.1190/1.1820161). Codes for applying the algorithms of Park et al. (1998) around the circumference can be found in the [PyDispersion package](https://github.com/luan-th-nguyen/PyDispersion) by Luan T. Nguyen on Github.



# Structure of the class

the following tree structure summarizes the order of calls and nested functions:

```
cmasw (class)
├── inverse
├── aimfuc
├── velocity
    ├── final
    ├── opt
        ├── fun    
```

The main function called to perform the inversion is `inverse`.

1. ## `inverse` function

    `inverse` executes the `aimfuc` function responsible for the least-squares optimization.  The algorithm used is called 'TRF' or Trust Region Reflective.

```python
def inverse(self):
    # I added an ftol for the least_squares algorithm below!
    popt = least_squares(self.aimfuc, self.init, bounds=(self.lb, self.ub), method='trf', args=(self.omega, self.y_data), ftol = 0.01) # 0.5 for example
    print("inversion is done")
    r = popt.x
    Vp = np.array(r[:self.num])
    Vs = np.array(r[self.num:self.num*2])
    Rho =  np.array(r[self.num*2:self.num*3])
    Nu = np.array(r[self.num * 3])
    #E = 2*rho*Vs**2*2*(1+mu)

    print('Shear Velocity', Vs)
    #print('Poisson Ratio', mu)
    print('P wave velocity:', Vp)
    #print('Youngs Modulus (MPa):', E/10**6)
    print('Density',Rho)
    print('ra/rb', Nu)

    if self.Savefile:
        np.savetxt('loss.csv', self.loss)
        np.savetxt('parameters.csv', self.para)
```

2. ## `aimfuc` function

It is designed to work with `scipy.optimize.least_squares`. It takes the initial values and their bounds and calls the `velocity` function inside to do the forward model.

```python    
def aimfuc(self, x, omega, y_data):
    '''
    Calculate the loss function. Perform the forward model and save
    outputs of a fitting iteration.
    '''
    vp = np.array(x[:self.num])
    vs = np.array(x[self.num:2*self.num])  
    rho = np.array(x[2 * self.num:3 * self.num])
    nu = np.array(x[3 * self.num])           
    yt =  self.velocity(omega, vp, vs, rho, nu)
    loss = np.abs(yt - y_data)    
    
    if self.Print_r:
        plt.clf()  
        plt.scatter(omega/(2*np.pi), y_data, label= 'measurement')    
        plt.plot(omega/(2*np.pi), yt, ':', label='Prediction')    
        self.loss.append(np.sqrt(np.sum(loss**2)))
        plt.title('TRF Algorithm, Iteration Number: %s; L2 Norm: %s' %(len(self.loss), int(self.loss[-1])))
        plt.legend()
        plt.xlabel('frequency (Hz)')
        plt.ylabel('Phase Velocity (m/s)')
        plt.savefig('dispersion_update.png')  
        print(np.sqrt(np.sum(loss ** 2)))
    
    if self.Savefile:
        np.savetxt('prediction.txt', yt)
        self.para.append(x)
    return loss  
    
```

3. ## `velocity` function

This function takes as inputs the frequency omega $\omega$, the logitudinal and transversal velocities ($v_P, v_S$), the densities and the fraction of radii of the concentric layers of the sphere or cylinder ($\eta$).

The function has three nested functions inside to perform the following tasks:

- Calculate the determinant for a given frequency $\omega$ and $k_p$ value (function `fun(k)`).
- Find the roots of the determinant by the bisection method (function `opt`).  In fact, we just find the first root since that is the one related to the propagation of a Rayleigh-type surface wave around the object; the other roots correspond to whispering gallery modes.
- Do the previous tasks in a parallelized manner using the [`joblib`](https://joblib.readthedocs.io/en/stable/) package calling the function `final`.

  *   ### `final` function
      calls `opt` for an omega ($\omega$) value given by the index $n$.

  *   ### `opt` function
      calculates the velocity as:
      $$v_S = R \frac{\omega}{k_p}$$
      where $k_p$ is the dimensionless spatial frequency:
      $$k_p = \frac{2\pi}{\lambda} R = kR$$

      For each value of $\omega$, `opt` explores the space of $k_p$ values that are roots (i.e zero crossings) of the determinant of the matrix describing the dispersion equations.  These roots are usually found by the bisection method.  Scipy has several functions for doing this, however, the one used here is [`scipy.optimize.brentq`](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.brentq.html).

    *   #### `fun` function
        This function calculates the determinant of any matrix related to the propagation of surface waves on the circumference of the object.  If the object is a cylinder, a sphere, or a concentric-layered version of those shapes, the `fun` function needs to call the appropriate code for setting the matrix of values concerning that model.

```python
def velocity(self, omega, vp, vs, rho, nu):
    '''
    Function to perform the forward model.
    '''
    def opt(i):
        def fun(k):
            matrix1 = Cooke_Rand_matrix(i, k, vp, vs, rho, nu, self.R)
            matrix2 = (matrix1)#/10**11
            sign, logdet = np.linalg.slogdet(matrix2)
            return np.real(sign * np.exp(logdet))
        c_test = 0.9*np.min(self.y_data) # 90% of the min. vel. of the dispersion curve is a sensible starting choice
        incre = self.R*i / c_test
        root = 0.00001
        for j in range(10**6):
            past = incre
            val1 = fun(incre)
            incre =  incre - 0.01
            val2 = fun(incre)
            if (np.real(val1) * np.real(val2) <= 0):
                root =  optimize.brentq(fun,incre, past)
                break
        return (self.R*i/root)     #give one value at a frequency

    def final(n):
        y = opt(omega[n])
        return y

    z2 = Parallel(n_jobs=-1)(delayed(final)(i) for i in range(len(omega)))
    return z2
```

# Hardware and Software
```
Python implementation: CPython
Python version       : 3.10.12
IPython version      : 8.14.0

numpy     : 1.25.1
matplotlib: 3.7.1
scipy     : 1.11.1
joblib    : 1.4.2 

Compiler    : GCC 12.3.0
OS          : Linux
Release     : 6.2.0-33-generic
Machine     : x86_64
Processor   : x86_64
CPU cores   : 12
Architecture: 64bit
```
